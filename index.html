
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Timer</title>
    
    <!-- 1. Import Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@200;400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- 2. INLINE CSS STYLES (Replaces Tailwind) -->
    <style>
        /* --- Base & Font --- */
        body { 
            font-family: 'Lexend', sans-serif; 
            min-height: 100vh;
            background-color: #000;
            color: #fff;
            position: relative;
            margin: 0;
        }

        /* --- Layout Containers --- */
        main {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .content-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 56rem; /* max-w-4xl */
            margin: 0 auto;
            padding-top: 2rem; /* pt-8 */
        }

        /* --- 1. Timeline --- */
        .timeline-container {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            margin-bottom: 0.5rem; /* mb-8 */
        }
        
        #timeline-labels {
            width: 100%;
            position: relative;
            height: 80vh;
        }

        .timeline-marker {
            position: absolute;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            transform: translateY(-50%);
        }

        .timeline-label {
            margin-right: 1rem; /* mr-4 */
            font-size: 1.875rem; /* text-3xl */
            font-weight: 700; /* font-bold */
            white-space: nowrap;
            display: block;
            color: #fff; /* text-white */
            transition: color 0.3s;
        }
        .timeline-label.is-passed {
            color: lime; /* text-green-400 */
        }

        .timeline-dot {
            width: 1.25rem; /* w-5 */
            height: 1.25rem; /* h-5 */
            border-radius: 9999px; /* rounded-full */
            background-color: #fff; /* bg-white */
            transition: background-color 0.3s;
        }
        .timeline-dot.is-passed {
            background-color: #22c55e; /* bg-green-500 */
        }

        /* --- 2. Main Content --- */
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: flex-start; /* items-start */
            width: 100%;
        }

        #digital-clock {
            font-size: 8rem; /* text-7xl */
            line-height: 1; /* leading-none */
            font-weight: 800; /* font-extrabold */
            color: #fff; /* text-white */
        }

        #exam-status-display {
            width: 100%;
            text-align: left;
        }
        
        /* Dynamic instruction text classes */
        .instruction-text {
            font-size: 2rem; /* text-2xl */
        }
        .instruction-header {
            font-weight: 700; /* font-bold */
            font-size: 1.7rem; /* text-2xl */
            margin-bottom: 0.5rem; /* mb-4 */
        }
        .instruction-italic {
            font-style: italic;
            font-size: 1.7rem; /* text-2xl */
        }
        .color-yellow {
            color: yellow; /* text-yellow-400 */
        }
        .color-red {
            color: red; /* text-red-400 */
        }
        .color-white {
            color: #fff; /* text-white */
        }


        /* --- 3. Button Bar --- */
        .button-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0.5rem 0; /* py-6 */
            z-index: 50;
        }
        
        .button-bar button {
            font-family: 'Lexend', sans-serif; 
            font-size: 0.7rem; /* text-base */
            font-weight: 300; /* font-semibold */
            color: #fff;
            background: none;
            border: none;
            cursor: pointer;
            opacity: 0.15; /* opacity-15 */
            transition: opacity 0.2s;
            margin: 0 1.5rem; /* space-x-12 (approx) */
        }
        
        .button-bar button:disabled,
        .button-bar button.is-disabled {
            opacity: 0.10; /* opacity-10 */
            cursor: not-allowed;
        }

        /* --- Responsive Media Queries --- */
        
        /* sm: (640px) */
        @media (min-width: 640px) {
            body {
                padding: 2rem; /* sm:p-8 */
            }
            .timeline-label {
                font-size: 2.25rem; /* sm:text-4xl */
            }
            #digital-clock {
                font-size: 5.625rem; /* sm:text-9xl */
            }
            .instruction-text {
                font-size: 1.875rem; /* sm:text-3xl */
            }
            .button-bar button {
                font-size: 1.125rem; /* sm:text-lg */
            }
        }
        
        /* md: (768px) */
        @media (min-width: 768px) {
            .content-wrapper {
                flex-direction: row; /* md:flex-row */
                align-items: flex-start; /* md:items-start */
            }
            .timeline-container {
                width: 12rem; /* md:w-48 */
                justify-content: flex-end; /* md:justify-end */
                margin-right: 4rem; /* md:mr-16 */
                margin-bottom: 0; /* md:mb-0 */
            }
        }

        /* lg: (1024px) */
        @media (min-width: 1024px) {
            .timeline-label {
                font-size: 3rem; /* lg:text-5xl */
            }
            #digital-clock {
                font-size: 8rem; /* lg:text-[12rem] - (12rem is huge, toning down to 8rem) */
            }
            .instruction-text {
                font-size: 2.25rem; /* lg:text-4xl */
            }
            .button-bar button {
                font-size: 1.25rem; /* lg:text-xl */
            }
        }

    </style>
</head>
<body class="bg-black text-white"> <!-- Removed Tailwind classes -->

    <!-- Main Content Area -->
    <main>
        <!-- Removed Tailwind classes -->
        <div class="content-wrapper">

            <!-- 1. Vertical Timeline (Left Side) -->
            <div class="timeline-container">
                <div class="w-full relative">
                    <div id="timeline-labels">
                        <!-- Timeline Labels and Ticks will be injected here by JS -->
                    </div>
                </div>
            </div>

            <!-- 2. Main Timer Content (Center) -->
            <div class="main-content">
                
                <!-- 1. TOP LEFT CLOCK (Dynamic) -->
                <div id="digital-clock">
                    <!-- Current time will be injected here by JS -->
                </div>
                
                <!-- Status/Warning Message (Dynamic) -->
                <div id="exam-status-display">
                    <!-- Exam status messages will be injected here by JS -->
                </div>
            </div>

        </div>
    </main>

    <!-- 3. FIXED BOTTOM BUTTONS -->
    <div class="button-bar">
        
        <!-- Start/Pause Button -->
        <button id="toggle-btn">Start</button>
        
        <!-- Reset Button -->
        <button id="reset-btn">Reset</button>

        <!-- Extra Time Toggle -->
        <button id="extra-time-btn">Extra Time OFF</button>
        
        <!-- Auto-Start Toggle -->
        <button id="auto-start-btn">Auto-Start OFF</button>
    </div>


    <!-- 4. JAVASCRIPT LOGIC -->
    <script>
        // --- CONFIGURATION ---
        const DEFAULT_DURATION_MINUTES = 180;
        const TOTAL_DURATION_SECONDS = DEFAULT_DURATION_MINUTES * 60;
        const WARNING_THRESHOLD_SECONDS = 15 * 60; // 15 minutes remaining
        const INITIAL_RESTRICTION_SECONDS = 45 * 60; // 45 minutes elapsed
        const EXTRA_TIME_LIMIT_SECONDS = -30 * 60; // Hard stop at -30 minutes

        // --- STATE VARIABLES ---
        let timeRemainingSeconds = TOTAL_DURATION_SECONDS;
        let isPaused = true;
        let isFinished = false;
        let isAutoStartEnabled = false;
        let autoStartTime = null;
        let isExtraTimeEnabled = false;
        
        // --- TIMER REFS ---
        let intervalRef = null;
        let checkIntervalRef = null;

        // --- DOM ELEMENT REFS ---
        let digitalClockEl;
        let timelineLabelsEl;
        let examStatusDisplayEl;
        let toggleBtn;
        let resetBtn;
        let extraTimeBtn;
        let autoStartBtn;

        // --- UTILITY FUNCTIONS ---
        const formatTimeHMM = (totalSeconds) => {
            const absSeconds = Math.abs(totalSeconds);
            const h = Math.floor(absSeconds / 3600); 
            const m = Math.floor((absSeconds % 3600) / 60);
            let timeString = `${h}:${String(m).padStart(2, '0')}`;
            return totalSeconds < 0 ? `-${timeString}` : timeString;
        };
        
        const formatTimeMMSS = (totalSeconds) => {
            const absSeconds = Math.abs(totalSeconds);
            const m = Math.floor(absSeconds / 60);
            const s = absSeconds % 60;
            return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        };

        const calculateNextHalfHourTime = () => {
            const now = new Date();
            let nextStart = new Date(now.getTime());
            const currentMinutes = now.getMinutes();
            if (currentMinutes < 30) {
                nextStart.setMinutes(30);
            } else {
                nextStart.setHours(now.getHours() + 1); 
                nextStart.setMinutes(0);
            }
            nextStart.setSeconds(0);
            nextStart.setMilliseconds(0);
            return nextStart;
        };

        // --- "COMPONENT" RENDER FUNCTIONS (Return HTML Strings) ---

        // Renders the Digital Clock (self-contained logic)
        function startDigitalClock() {
            if (!digitalClockEl) return;
            
            const updateClock = () => {
                const time = new Date();
                const formattedTime = time.toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                });
                digitalClockEl.textContent = formattedTime;
            };
            
            updateClock(); // Initial call
            setInterval(updateClock, 1000); // Update every second
        }

        // Renders the Exam Status Display HTML
        function getExamStatusDisplayHTML(state) {
            const { isPaused, isFinished, isWarning, isRestricted, isExtraTimeEnabled, isAutoStartEnabled, timeRemainingSeconds, autoStartTime } = state;
            
            // CSS classes are now defined in the <style> tag
            const baseClass = "instruction-text";
            const headerClass = `${baseClass} instruction-header color-yellow`;
            const italicClass = `${baseClass} instruction-italic color-white`;

            // --- STAGE 1: Extra Time Hard Stop ---
            if (isExtraTimeEnabled && timeRemainingSeconds <= EXTRA_TIME_LIMIT_SECONDS) {
                return `
                    <div>
                        <h1 class="${headerClass}">The exam has ended.</h1>
                        <h2 class="${italicClass}">You must stop writing.</h2>
                        <h2 class="${italicClass}">Please remain silent as there may be other candidates still writing.</h2>
                        <h2 class="${italicClass}">Listen carefully to all exit instructions.</h2>
                        <h2 class="${italicClass}">You will be told when you can leave.</h2>
                    </div>`;
            }
            // --- STAGE 2: Extra Time Active ---
            if (isFinished && isExtraTimeEnabled && timeRemainingSeconds < 0) {
                return `
                    <div>
                        <h1 class="${headerClass}">Extra Time is in progress.</h1>
                        <h2 class="${baseClass} instruction-italic color-red">(Extra Time: ${formatTimeMMSS(timeRemainingSeconds)})</h2>
                    </div>`;
            }
            // --- STAGE 3: Finished (Standard) ---
            if (isFinished) {
                return `
                    <div>
                        <h1 class="${headerClass}">The exam has ended.</h1>
                        <h2 class="${italicClass}">You must stop writing.</h2>
                        <h2 class="${italicClass}">Please remain silent as there may be other candidates still writing.</h2>
                        <h2 class="${italicClass}">Listen carefully to all exit instructions.</h2>
                        <h2 class="${italicClass}">You will be told when you can leave.</h2>
                    </div>`;
            }
            // --- STAGE 4: Auto-Start Scheduled ---
            if (isAutoStartEnabled && isPaused && autoStartTime) {
                return `
                    <div>
                        <h1 class="${headerClass}">You must hand in ALL exam answer booklets</h1>
                        <h2 class="${italicClass}">If you have not written in an answer booklet, please put an 'X' in the box on the front before you hand it in.</h2>
                        <h2 class="${italicClass}">You may keep any resource booklets, or hand them in to be recycled.</h2>
                    </div>`;       
            }
            // --- STAGE 5: Timer Paused (Mid-Exam) ---
            if (isPaused && timeRemainingSeconds < TOTAL_DURATION_SECONDS) {
                return `
                    <div>
                        <h1 class="${headerClass}">The exam is paused. Please stop writing</h1>
                        <h2 class="${italicClass}">You will be told when you can begin writing again.</h2>
                    </div>`;
            }
            // --- STAGE 6: Ready to Start (Initial State) ---
            if (isPaused) {
                return `
                    <div>
                        <h1 class="${headerClass}">You must hand in ALL exam answer booklets</h1>
                        <h2 class="${italicClass}">If you have not written in an answer booklet, please put an 'X' in the box on the front before you hand it in.</h2>
                        <h2 class="${italicClass}">You may keep any resource booklets, or hand them in to be recycled.</h2>
                    </div>`;
            }
            // --- STAGE 7: Warning Period ---
            if (isWarning) {
                return `
                    <div>
                        <h1 class="${headerClass}">You may not leave in the final 15 minutes of the exam.</h1>
                        <h2 class="${italicClass}">If you are finished, stay seated and wait for the exam to end.</h2>
                    </div>`;
            }
            // --- STAGE 8: Restriction Period ---
            if (isRestricted) {
                return `
                    <div>
                        <h1 class="${headerClass}">You may not leave in the first 45 minutes of the exam.</h1>
                        <h2 class="${italicClass}">Please stay in your seat. If you need a supervisor, raise your hand.</h2>
                    </div>`;
            }
            // --- STAGE 9: Exam In Progress (Default) ---
            return `
                <div>
                    <h1 class="${headerClass}">Please remain seated at your desk at all times.</h1>
                    <h2 class="${italicClass}">If you need to visit the bathroom, raise your hand.</h2>
                    <h2 class="${italicClass}">If you are finished and would like to leave, raise your hand.</h2>
                </div>`;
        }

        // Renders the Vertical Timeline HTML
        function getVerticalTimelineLabelsHTML(state) {
            const { timeRemainingSeconds, isPaused, isFinished } = state;
            const timeElapsedSeconds = TOTAL_DURATION_SECONDS - timeRemainingSeconds;
            
            let labelsHTML = '';
            const intervalMins = 15; 

            for (let min = 0; min <= DEFAULT_DURATION_MINUTES; min += intervalMins) {
                const percent = (min / DEFAULT_DURATION_MINUTES) * 100;
                const timeSeconds = min * 60;
                const timeLabel = formatTimeHMM(timeSeconds).replace('-', '');

                const time = min === 0 ? 'Start' : (min === DEFAULT_DURATION_MINUTES ? 'Finish' : timeLabel);
                
                let isPassed = timeSeconds <= timeElapsedSeconds;
                if (timeSeconds === 0) {
                    isPassed = !isPaused || (timeElapsedSeconds > 0) || isFinished;
                }

                // UPDATED: Use new CSS classes
                const passedClass = isPassed ? 'is-passed' : '';
                
                labelsHTML += `
                    <div class="timeline-marker" style="top: ${percent}%;">
                        <span class="timeline-label ${passedClass}">${time}</span>
                        <div class="timeline-dot ${passedClass}"></div>
                    </div>`;
            }
            return labelsHTML;
        }

        // --- MAIN UI UPDATE FUNCTION ---
        function updateUI() {
            if (!timelineLabelsEl || !examStatusDisplayEl || !toggleBtn || !resetBtn || !extraTimeBtn || !autoStartBtn) {
                console.error("DOM elements not found. UI cannot update.");
                return;
            }

            // 1. Calculate derived state
            const timeElapsedSeconds = TOTAL_DURATION_SECONDS - timeRemainingSeconds;
            const isWarning = timeRemainingSeconds > 0 && timeRemainingSeconds <= WARNING_THRESHOLD_SECONDS;
            const isRestricted = !isPaused && timeElapsedSeconds >= 0 && timeElapsedSeconds <= INITIAL_RESTRICTION_SECONDS; 
            
            // 2. Create a state snapshot object
            const currentState = {
                isPaused,
                isFinished,
                isWarning,
                isRestricted,
                isExtraTimeEnabled,
                isAutoStartEnabled,
                timeRemainingSeconds,
                autoStartTime
            };

            // 3. Update Timeline
            timelineLabelsEl.innerHTML = getVerticalTimelineLabelsHTML(currentState);

            // 4. Update Status Display
            examStatusDisplayEl.innerHTML = getExamStatusDisplayHTML(currentState);

            // 5. Update Buttons
            const isStartButtonDisabled = isAutoStartEnabled;
            const isAtHardStop = (timeRemainingSeconds <= EXTRA_TIME_LIMIT_SECONDS && isExtraTimeEnabled);
            const isAutoStartDisabled = !isPaused || isFinished;

            // Toggle Button
            toggleBtn.textContent = isPaused ? 'Start' : 'Pause';
            toggleBtn.disabled = isStartButtonDisabled || isAtHardStop;
            // UPDATED: Use classList.toggle with 'is-disabled'
            toggleBtn.classList.toggle('is-disabled', toggleBtn.disabled);

            // Extra Time Button
            extraTimeBtn.textContent = `Extra Time ${isExtraTimeEnabled ? 'ON' : 'OFF'}`;
            extraTimeBtn.disabled = isAtHardStop;
            extraTimeBtn.classList.toggle('is-disabled', extraTimeBtn.disabled);
            
            // Auto-Start Button
            autoStartBtn.textContent = `Auto-Start ${isAutoStartEnabled ? 'ON' : 'OFF'}`;
            autoStartBtn.disabled = isAutoStartDisabled;
            autoStartBtn.classList.toggle('is-disabled', autoStartBtn.disabled);
        }

        // --- TIMER LOGIC ---
        function tick() {
            timeRemainingSeconds = timeRemainingSeconds - 1;
            
            let shouldStopTimer = false;

            if (!isExtraTimeEnabled && timeRemainingSeconds < 0) {
                shouldStopTimer = true;
                isFinished = true;
                timeRemainingSeconds = 0;
            }

            if (isExtraTimeEnabled && timeRemainingSeconds <= EXTRA_TIME_LIMIT_SECONDS) {
                shouldStopTimer = true;
                isFinished = true;
                timeRemainingSeconds = EXTRA_TIME_LIMIT_SECONDS;
            }
            
            if (timeRemainingSeconds <= 0 && (timeRemainingSeconds + 1) > 0) {
                isFinished = true;
            }
            
            if (shouldStopTimer && intervalRef) {
                clearInterval(intervalRef);
                intervalRef = null;
                isPaused = true;
            }
            
            updateUI();
        }

        function toggleTimer() {
            if (isPaused) {
                if (!intervalRef) {
                    intervalRef = setInterval(tick, 1000);
                }
                isPaused = false;
            } else {
                if (intervalRef) {
                    clearInterval(intervalRef);
                    intervalRef = null;
                }
                isPaused = true;
            }
            updateUI();
        }

        function resetTimer() {
            if (intervalRef) {
                clearInterval(intervalRef);
                intervalRef = null;
            }
            if (checkIntervalRef) {
                clearInterval(checkIntervalRef);
                checkIntervalRef = null;
            }
            isAutoStartEnabled = false;
            autoStartTime = null;
            timeRemainingSeconds = TOTAL_DURATION_SECONDS;
            isPaused = true;
            isFinished = false;
            
            updateUI();
        }

        // --- AUTO-START LOGIC ---
        function manageAutoStart() {
            if (!isAutoStartEnabled || !isPaused || isFinished) {
                if (checkIntervalRef) {
                    clearInterval(checkIntervalRef);
                    checkIntervalRef = null;
                }
                if (!isAutoStartEnabled) {
                    autoStartTime = null;
                }
                updateUI();
                return;
            }

            if (!autoStartTime) {
                autoStartTime = calculateNextHalfHourTime();
                updateUI();
            }

            if (!checkIntervalRef) {
                checkIntervalRef = setInterval(() => {
                    const now = new Date();
                    
                    if (now.getTime() >= autoStartTime.getTime()) {
                        clearInterval(checkIntervalRef);
                        checkIntervalRef = null;
                        isAutoStartEnabled = false;
                        
                        if (isPaused && !intervalRef) {
                            toggleTimer();
                        } else {
                            updateUI();
                        }
                    }
                }, 500);
            }
        }

        // --- EVENT HANDLERS ---
        function handleToggleClick() {
            toggleTimer();
        }

        function handleResetClick() {
            resetTimer();
        }

        function handleExtraTimeClick() {
            isExtraTimeEnabled = !isExtraTimeEnabled;
            updateUI();
        }

        function handleAutoStartClick() {
            isAutoStartEnabled = !isAutoStartEnabled;
            manageAutoStart();
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            // Get all DOM elements
            digitalClockEl = document.getElementById('digital-clock');
            timelineLabelsEl = document.getElementById('timeline-labels');
            examStatusDisplayEl = document.getElementById('exam-status-display');
            toggleBtn = document.getElementById('toggle-btn');
            resetBtn = document.getElementById('reset-btn');
            extraTimeBtn = document.getElementById('extra-time-btn');
            autoStartBtn = document.getElementById('auto-start-btn');
            
            // Attach event listeners
            toggleBtn.addEventListener('click', handleToggleClick);
            resetBtn.addEventListener('click', handleResetClick);
            extraTimeBtn.addEventListener('click', handleExtraTimeClick);
            autoStartBtn.addEventListener('click', handleAutoStartClick);

            // Start the digital clock
            startDigitalClock();

            // Perform initial render
            updateUI();
        });

    </script>
</body>
</html>

